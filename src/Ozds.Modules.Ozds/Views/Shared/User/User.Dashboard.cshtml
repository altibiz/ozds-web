@using YesSql
@using Ozds.Elasticsearch
@using Ozds.Extensions

@inject ISession Session
@inject IDashboardMeasurementProvider Provider

@{
  var now = DateTime.UtcNow;

  var user = await OrchardUser;
  var userId = user.UserId;

  var userMeasurements = await Provider
    .GetDashboardMeasurementsByOwnerUserAsync(
      userId,
      new Period
      {
        From =
          Context.Request.Query["from"]
            .FirstOrDefault()
            .WhenNonNull(dateString => dateString.ToUtcIsoDateTime())
            .WhenNull(now.AddMinutes(-60)),
        To =
          Context.Request.Query["to"]
            .FirstOrDefault()
            .WhenNonNull(dateString => dateString.ToUtcIsoDateTime())
            .WhenNull(now),
      });
}

<partial name="MultiDashboard" model="@userMeasurements" />

<partial name="User/User.Site" />