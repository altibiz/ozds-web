@using Ozds.Modules.Ozds
@using Ozds.Elasticsearch
@using Ozds.Extensions

@inject IDashboardMeasurementProvider Provider

@model SecondarySiteType

@{
  var now = DateTime.UtcNow;

  var fromQuery = Context.Request.Query["from"].FirstOrDefault();
  var from =
    string.IsNullOrEmpty(fromQuery) ? now.AddMinutes(-60)
    : fromQuery.ToUtcIsoDateTime();

  var toQuery = Context.Request.Query["to"].FirstOrDefault();
  var to =
    string.IsNullOrEmpty(toQuery) ? now
    : toQuery.ToUtcIsoDateTime();

  var measurements = await Provider
    .GetDashboardMeasurementsAsync(
      Model.Site.Value.DeviceId,
      new Period
      {
        From = from,
        To = to,
      });
}

<partial name="Dashboard" model="@measurements" />