@using Ozds.Modules.Ozds
@using Ozds.Elasticsearch
@using Ozds.Extensions

@inject IDashboardMeasurementProvider Provider

@model SecondarySiteType

@{
  var now = DateTime.UtcNow;
  var measurements = await Provider
    .GetDashboardMeasurementsAsync(
      Model.Site.Value.DeviceId,
      new Period
      {
        From =
          Context.Request.Query["from"]
            .FirstOrDefault()
            .WhenNonNull(dateString => dateString.ToUtcIsoDateTime())
            .WhenNull(now.AddMinutes(-60)),
        To =
          Context.Request.Query["to"]
            .FirstOrDefault()
            .WhenNonNull(dateString => dateString.ToUtcIsoDateTime())
            .WhenNull(now),
      });
}

<partial name="Dashboard" model="@measurements" />